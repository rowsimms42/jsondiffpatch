{"version":3,"file":"jsondiffpatch.cjs.js","sources":["../src/processor.js","../src/pipe.js","../src/contexts/context.js","../src/clone.js","../src/contexts/diff.js","../src/contexts/patch.js","../src/contexts/reverse.js","../src/filters/trivial.js","../src/filters/nested.js","../src/filters/lcs.js","../src/filters/arrays.js","../src/filters/dates.js","../src/filters/texts.js","../src/diffpatcher.js","../src/formatters/base.js","../src/formatters/html.js","../src/formatters/annotated.js","../src/formatters/jsonpatch.js","../src/formatters/console.js","../src/date-reviver.js","../src/main.js"],"sourcesContent":["class Processor {\r\n  constructor(options) {\r\n    this.selfOptions = options || {};\r\n    this.pipes = {};\r\n  }\r\n\r\n  options(options) {\r\n    if (options) {\r\n      this.selfOptions = options;\r\n    }\r\n    return this.selfOptions;\r\n  }\r\n\r\n  pipe(name, pipeArg) {\r\n    let pipe = pipeArg;\r\n    if (typeof name === 'string') {\r\n      if (typeof pipe === 'undefined') {\r\n        return this.pipes[name];\r\n      } else {\r\n        this.pipes[name] = pipe;\r\n      }\r\n    }\r\n    if (name && name.name) {\r\n      pipe = name;\r\n      if (pipe.processor === this) {\r\n        return pipe;\r\n      }\r\n      this.pipes[pipe.name] = pipe;\r\n    }\r\n    pipe.processor = this;\r\n    return pipe;\r\n  }\r\n\r\n  process(input, pipe) {\r\n    let context = input;\r\n    context.options = this.options();\r\n    let nextPipe = pipe || input.pipe || 'default';\r\n    let lastPipe;\r\n    let lastContext;\r\n    while (nextPipe) {\r\n      if (typeof context.nextAfterChildren !== 'undefined') {\r\n        // children processed and coming back to parent\r\n        context.next = context.nextAfterChildren;\r\n        context.nextAfterChildren = null;\r\n      }\r\n\r\n      if (typeof nextPipe === 'string') {\r\n        nextPipe = this.pipe(nextPipe);\r\n      }\r\n      nextPipe.process(context);\r\n      lastContext = context;\r\n      lastPipe = nextPipe;\r\n      nextPipe = null;\r\n      if (context) {\r\n        if (context.next) {\r\n          context = context.next;\r\n          nextPipe = lastContext.nextPipe || context.pipe || lastPipe;\r\n        }\r\n      }\r\n    }\r\n    return context.hasResult ? context.result : undefined;\r\n  }\r\n}\r\n\r\nexport default Processor;\r\n","class Pipe {\r\n  constructor(name) {\r\n    this.name = name;\r\n    this.filters = [];\r\n  }\r\n\r\n  process(input) {\r\n    if (!this.processor) {\r\n      throw new Error('add this pipe to a processor before using it');\r\n    }\r\n    let debug = this.debug;\r\n    let length = this.filters.length;\r\n    let context = input;\r\n    for (let index = 0; index < length; index++) {\r\n      let filter = this.filters[index];\r\n      if (debug) {\r\n        this.log(`filter: ${filter.filterName}`);\r\n      }\r\n      filter(context);\r\n      if (typeof context === 'object' && context.exiting) {\r\n        context.exiting = false;\r\n        break;\r\n      }\r\n    }\r\n    if (!context.next && this.resultCheck) {\r\n      this.resultCheck(context);\r\n    }\r\n  }\r\n\r\n  log(msg) {\r\n    console.log(`[jsondiffpatch] ${this.name} pipe, ${msg}`);\r\n  }\r\n\r\n  append(...args) {\r\n    this.filters.push(...args);\r\n    return this;\r\n  }\r\n\r\n  prepend(...args) {\r\n    this.filters.unshift(...args);\r\n    return this;\r\n  }\r\n\r\n  indexOf(filterName) {\r\n    if (!filterName) {\r\n      throw new Error('a filter name is required');\r\n    }\r\n    for (let index = 0; index < this.filters.length; index++) {\r\n      let filter = this.filters[index];\r\n      if (filter.filterName === filterName) {\r\n        return index;\r\n      }\r\n    }\r\n    throw new Error(`filter not found: ${filterName}`);\r\n  }\r\n\r\n  list() {\r\n    return this.filters.map(f => f.filterName);\r\n  }\r\n\r\n  after(filterName) {\r\n    let index = this.indexOf(filterName);\r\n    let params = Array.prototype.slice.call(arguments, 1);\r\n    if (!params.length) {\r\n      throw new Error('a filter is required');\r\n    }\r\n    params.unshift(index + 1, 0);\r\n    Array.prototype.splice.apply(this.filters, params);\r\n    return this;\r\n  }\r\n\r\n  before(filterName) {\r\n    let index = this.indexOf(filterName);\r\n    let params = Array.prototype.slice.call(arguments, 1);\r\n    if (!params.length) {\r\n      throw new Error('a filter is required');\r\n    }\r\n    params.unshift(index, 0);\r\n    Array.prototype.splice.apply(this.filters, params);\r\n    return this;\r\n  }\r\n\r\n  replace(filterName) {\r\n    let index = this.indexOf(filterName);\r\n    let params = Array.prototype.slice.call(arguments, 1);\r\n    if (!params.length) {\r\n      throw new Error('a filter is required');\r\n    }\r\n    params.unshift(index, 1);\r\n    Array.prototype.splice.apply(this.filters, params);\r\n    return this;\r\n  }\r\n\r\n  remove(filterName) {\r\n    let index = this.indexOf(filterName);\r\n    this.filters.splice(index, 1);\r\n    return this;\r\n  }\r\n\r\n  clear() {\r\n    this.filters.length = 0;\r\n    return this;\r\n  }\r\n\r\n  shouldHaveResult(should) {\r\n    if (should === false) {\r\n      this.resultCheck = null;\r\n      return;\r\n    }\r\n    if (this.resultCheck) {\r\n      return;\r\n    }\r\n    let pipe = this;\r\n    this.resultCheck = context => {\r\n      if (!context.hasResult) {\r\n        console.log(context);\r\n        let error = new Error(`${pipe.name} failed`);\r\n        error.noResult = true;\r\n        throw error;\r\n      }\r\n    };\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default Pipe;\r\n","import Pipe from '../pipe';\r\n\r\nexport default class Context {\r\n  setResult(result) {\r\n    this.result = result;\r\n    this.hasResult = true;\r\n    return this;\r\n  }\r\n\r\n  exit() {\r\n    this.exiting = true;\r\n    return this;\r\n  }\r\n\r\n  switchTo(next, pipe) {\r\n    if (typeof next === 'string' || next instanceof Pipe) {\r\n      this.nextPipe = next;\r\n    } else {\r\n      this.next = next;\r\n      if (pipe) {\r\n        this.nextPipe = pipe;\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  push(child, name) {\r\n    child.parent = this;\r\n    if (typeof name !== 'undefined') {\r\n      child.childName = name;\r\n    }\r\n    child.root = this.root || this;\r\n    child.options = child.options || this.options;\r\n    if (!this.children) {\r\n      this.children = [child];\r\n      this.nextAfterChildren = this.next || null;\r\n      this.next = child;\r\n    } else {\r\n      this.children[this.children.length - 1].next = child;\r\n      this.children.push(child);\r\n    }\r\n    child.next = this;\r\n    return this;\r\n  }\r\n}\r\n","const isArray =\r\n  typeof Array.isArray === 'function' ? Array.isArray : a => a instanceof Array;\r\n\r\nfunction cloneRegExp(re) {\r\n  let regexMatch = /^\\/(.*)\\/([gimyu]*)$/.exec(re.toString());\r\n  return new RegExp(regexMatch[1], regexMatch[2]);\r\n}\r\n\r\nexport default function clone(arg) {\r\n  if (typeof arg !== 'object') {\r\n    return arg;\r\n  }\r\n  if (arg === null) {\r\n    return null;\r\n  }\r\n  if (isArray(arg)) {\r\n    return arg.map(clone);\r\n  }\r\n  if (arg instanceof Date) {\r\n    return new Date(arg.getTime());\r\n  }\r\n  if (arg instanceof RegExp) {\r\n    return cloneRegExp(arg);\r\n  }\r\n  let cloned = {};\r\n  for (let name in arg) {\r\n    if (Object.prototype.hasOwnProperty.call(arg, name)) {\r\n      cloned[name] = clone(arg[name]);\r\n    }\r\n  }\r\n  return cloned;\r\n}\r\n","import Context from './context';\r\nimport defaultClone from '../clone';\r\n\r\nclass DiffContext extends Context {\r\n  constructor(left, right) {\r\n    super();\r\n    this.left = left;\r\n    this.right = right;\r\n    this.pipe = 'diff';\r\n  }\r\n\r\n  setResult(result) {\r\n    if (this.options.cloneDiffValues && typeof result === 'object') {\r\n      const clone =\r\n        typeof this.options.cloneDiffValues === 'function'\r\n          ? this.options.cloneDiffValues\r\n          : defaultClone;\r\n      if (typeof result[0] === 'object') {\r\n        result[0] = clone(result[0]);\r\n      }\r\n      if (typeof result[1] === 'object') {\r\n        result[1] = clone(result[1]);\r\n      }\r\n    }\r\n    return Context.prototype.setResult.apply(this, arguments);\r\n  }\r\n}\r\n\r\nexport default DiffContext;\r\n","import Context from './context';\r\n\r\nclass PatchContext extends Context {\r\n  constructor(left, delta) {\r\n    super();\r\n    this.left = left;\r\n    this.delta = delta;\r\n    this.pipe = 'patch';\r\n  }\r\n}\r\n\r\nexport default PatchContext;\r\n","import Context from './context';\r\n\r\nclass ReverseContext extends Context {\r\n  constructor(delta) {\r\n    super();\r\n    this.delta = delta;\r\n    this.pipe = 'reverse';\r\n  }\r\n}\r\n\r\nexport default ReverseContext;\r\n","const isArray =\r\n  typeof Array.isArray === 'function'\r\n    ? Array.isArray\r\n    : function(a) {\r\n      return a instanceof Array;\r\n    };\r\n\r\nexport const diffFilter = function trivialMatchesDiffFilter(context) {\r\n  if (context.left === context.right) {\r\n    context.setResult(undefined).exit();\r\n    return;\r\n  }\r\n  if (typeof context.left === 'undefined') {\r\n    if (typeof context.right === 'function') {\r\n      throw new Error('functions are not supported');\r\n    }\r\n    context.setResult([context.right]).exit();\r\n    return;\r\n  }\r\n  if (typeof context.right === 'undefined') {\r\n    context.setResult([context.left, 0, 0]).exit();\r\n    return;\r\n  }\r\n  if (\r\n    typeof context.left === 'function' ||\r\n    typeof context.right === 'function'\r\n  ) {\r\n    throw new Error('functions are not supported');\r\n  }\r\n  context.leftType = context.left === null ? 'null' : typeof context.left;\r\n  context.rightType = context.right === null ? 'null' : typeof context.right;\r\n  if (context.leftType !== context.rightType) {\r\n    context.setResult([context.left, context.right]).exit();\r\n    return;\r\n  }\r\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\r\n    context.setResult([context.left, context.right]).exit();\r\n    return;\r\n  }\r\n  if (context.leftType === 'object') {\r\n    context.leftIsArray = isArray(context.left);\r\n  }\r\n  if (context.rightType === 'object') {\r\n    context.rightIsArray = isArray(context.right);\r\n  }\r\n  if (context.leftIsArray !== context.rightIsArray) {\r\n    context.setResult([context.left, context.right]).exit();\r\n    return;\r\n  }\r\n\r\n  if (context.left instanceof RegExp) {\r\n    if (context.right instanceof RegExp) {\r\n      context\r\n        .setResult([context.left.toString(), context.right.toString()])\r\n        .exit();\r\n    } else {\r\n      context.setResult([context.left, context.right]).exit();\r\n    }\r\n  }\r\n};\r\ndiffFilter.filterName = 'trivial';\r\n\r\nexport const patchFilter = function trivialMatchesPatchFilter(context) {\r\n  if (typeof context.delta === 'undefined') {\r\n    context.setResult(context.left).exit();\r\n    return;\r\n  }\r\n  context.nested = !isArray(context.delta);\r\n  if (context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta.length === 1) {\r\n    context.setResult(context.delta[0]).exit();\r\n    return;\r\n  }\r\n  if (context.delta.length === 2) {\r\n    if (context.left instanceof RegExp) {\r\n      const regexArgs = /^\\/(.*)\\/([gimyu]+)$/.exec(context.delta[1]);\r\n      if (regexArgs) {\r\n        context.setResult(new RegExp(regexArgs[1], regexArgs[2])).exit();\r\n        return;\r\n      }\r\n    }\r\n    context.setResult(context.delta[1]).exit();\r\n    return;\r\n  }\r\n  if (context.delta.length === 3 && context.delta[2] === 0) {\r\n    context.setResult(undefined).exit();\r\n  }\r\n};\r\npatchFilter.filterName = 'trivial';\r\n\r\nexport const reverseFilter = function trivialReferseFilter(context) {\r\n  if (typeof context.delta === 'undefined') {\r\n    context.setResult(context.delta).exit();\r\n    return;\r\n  }\r\n  context.nested = !isArray(context.delta);\r\n  if (context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta.length === 1) {\r\n    context.setResult([context.delta[0], 0, 0]).exit();\r\n    return;\r\n  }\r\n  if (context.delta.length === 2) {\r\n    context.setResult([context.delta[1], context.delta[0]]).exit();\r\n    return;\r\n  }\r\n  if (context.delta.length === 3 && context.delta[2] === 0) {\r\n    context.setResult([context.delta[0]]).exit();\r\n  }\r\n};\r\nreverseFilter.filterName = 'trivial';\r\n","import DiffContext from '../contexts/diff';\r\nimport PatchContext from '../contexts/patch';\r\nimport ReverseContext from '../contexts/reverse';\r\n\r\nexport function collectChildrenDiffFilter(context) {\r\n  if (!context || !context.children) {\r\n    return;\r\n  }\r\n  const length = context.children.length;\r\n  let child;\r\n  let result = context.result;\r\n  for (let index = 0; index < length; index++) {\r\n    child = context.children[index];\r\n    if (typeof child.result === 'undefined') {\r\n      continue;\r\n    }\r\n    result = result || {};\r\n    result[child.childName] = child.result;\r\n  }\r\n  if (result && context.leftIsArray) {\r\n    result._t = 'a';\r\n  }\r\n  context.setResult(result).exit();\r\n}\r\ncollectChildrenDiffFilter.filterName = 'collectChildren';\r\n\r\nexport function objectsDiffFilter(context) {\r\n  if (context.leftIsArray || context.leftType !== 'object') {\r\n    return;\r\n  }\r\n\r\n  let name;\r\n  let child;\r\n  const propertyFilter = context.options.propertyFilter;\r\n  for (name in context.left) {\r\n    if (!Object.prototype.hasOwnProperty.call(context.left, name)) {\r\n      continue;\r\n    }\r\n    if (propertyFilter && !propertyFilter(name, context)) {\r\n      continue;\r\n    }\r\n    child = new DiffContext(context.left[name], context.right[name]);\r\n    context.push(child, name);\r\n  }\r\n  for (name in context.right) {\r\n    if (!Object.prototype.hasOwnProperty.call(context.right, name)) {\r\n      continue;\r\n    }\r\n    if (propertyFilter && !propertyFilter(name, context)) {\r\n      continue;\r\n    }\r\n    if (typeof context.left[name] === 'undefined') {\r\n      child = new DiffContext(undefined, context.right[name]);\r\n      context.push(child, name);\r\n    }\r\n  }\r\n\r\n  if (!context.children || context.children.length === 0) {\r\n    context.setResult(undefined).exit();\r\n    return;\r\n  }\r\n  context.exit();\r\n}\r\nobjectsDiffFilter.filterName = 'objects';\r\n\r\nexport const patchFilter = function nestedPatchFilter(context) {\r\n  if (!context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta._t) {\r\n    return;\r\n  }\r\n  let name;\r\n  let child;\r\n  for (name in context.delta) {\r\n    child = new PatchContext(context.left[name], context.delta[name]);\r\n    context.push(child, name);\r\n  }\r\n  context.exit();\r\n};\r\npatchFilter.filterName = 'objects';\r\n\r\nexport const collectChildrenPatchFilter = function collectChildrenPatchFilter(\r\n  context\r\n) {\r\n  if (!context || !context.children) {\r\n    return;\r\n  }\r\n  if (context.delta._t) {\r\n    return;\r\n  }\r\n  let length = context.children.length;\r\n  let child;\r\n  for (let index = 0; index < length; index++) {\r\n    child = context.children[index];\r\n    if (\r\n      Object.prototype.hasOwnProperty.call(context.left, child.childName) &&\r\n      child.result === undefined\r\n    ) {\r\n      delete context.left[child.childName];\r\n    } else if (context.left[child.childName] !== child.result) {\r\n      context.left[child.childName] = child.result;\r\n    }\r\n  }\r\n  context.setResult(context.left).exit();\r\n};\r\ncollectChildrenPatchFilter.filterName = 'collectChildren';\r\n\r\nexport const reverseFilter = function nestedReverseFilter(context) {\r\n  if (!context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta._t) {\r\n    return;\r\n  }\r\n  let name;\r\n  let child;\r\n  for (name in context.delta) {\r\n    child = new ReverseContext(context.delta[name]);\r\n    context.push(child, name);\r\n  }\r\n  context.exit();\r\n};\r\nreverseFilter.filterName = 'objects';\r\n\r\nexport function collectChildrenReverseFilter(context) {\r\n  if (!context || !context.children) {\r\n    return;\r\n  }\r\n  if (context.delta._t) {\r\n    return;\r\n  }\r\n  let length = context.children.length;\r\n  let child;\r\n  let delta = {};\r\n  for (let index = 0; index < length; index++) {\r\n    child = context.children[index];\r\n    if (delta[child.childName] !== child.result) {\r\n      delta[child.childName] = child.result;\r\n    }\r\n  }\r\n  context.setResult(delta).exit();\r\n}\r\ncollectChildrenReverseFilter.filterName = 'collectChildren';\r\n","/*\r\n\r\nLCS implementation that supports arrays or strings\r\n\r\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\r\n\r\n*/\r\n\r\nconst defaultMatch = function(array1, array2, index1, index2) {\r\n  return array1[ index1 ] === array2[ index2 ];\r\n};\r\n\r\nconst lengthMatrix = function(array1, array2, match, context) {\r\n  const len1 = array1.length;\r\n  const len2 = array2.length;\r\n  let x, y;\r\n\r\n  // initialize empty matrix of len1+1 x len2+1\r\n  let matrix = [ len1 + 1 ];\r\n  for (x = 0; x < len1 + 1; x++) {\r\n    matrix[ x ] = [ len2 + 1 ];\r\n    for (y = 0; y < len2 + 1; y++) {\r\n      matrix[ x ][ y ] = 0;\r\n    }\r\n  }\r\n  matrix.match = match;\r\n  // save sequence lengths for each coordinate\r\n  for (x = 1; x < len1 + 1; x++) {\r\n    for (y = 1; y < len2 + 1; y++) {\r\n      if (match(array1, array2, x - 1, y - 1, context)) {\r\n        matrix[ x ][ y ] = matrix[ x - 1 ][ y - 1 ] + 1;\r\n      } else {\r\n        matrix[ x ][ y ] = Math.max(matrix[ x - 1 ][ y ], matrix[ x ][ y - 1 ]);\r\n      }\r\n    }\r\n  }\r\n  return matrix;\r\n};\r\n\r\nconst backtrack = function(matrix, array1, array2, context) {\r\n  let index1 = array1.length;\r\n  let index2 = array2.length;\r\n  const subsequence = {\r\n    sequence: [],\r\n    indices1: [],\r\n    indices2: [],\r\n  };\r\n\r\n  while (index1 !== 0 && index2 !== 0) {\r\n    const sameLetter =\r\n      matrix.match(array1, array2, index1 - 1, index2 - 1, context);\r\n    if (sameLetter) {\r\n      subsequence.sequence.unshift(array1[ index1 - 1 ]);\r\n      subsequence.indices1.unshift(index1 - 1);\r\n      subsequence.indices2.unshift(index2 - 1);\r\n      --index1;\r\n      --index2;\r\n    } else {\r\n      const valueAtMatrixAbove = matrix[ index1 ][ index2 - 1 ];\r\n      const valueAtMatrixLeft = matrix[ index1 - 1 ][ index2 ];\r\n      if (valueAtMatrixAbove > valueAtMatrixLeft) {\r\n        --index2;\r\n      } else {\r\n        --index1;\r\n      }\r\n    }\r\n  }\r\n  return subsequence;\r\n};\r\n\r\nconst get = function(array1, array2, match, context) {\r\n  const innerContext = context || {};\r\n  const matrix = lengthMatrix(\r\n    array1,\r\n    array2,\r\n    match || defaultMatch,\r\n    innerContext\r\n  );\r\n  const result = backtrack(\r\n    matrix,\r\n    array1,\r\n    array2,\r\n    innerContext\r\n  );\r\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\r\n    result.sequence = result.sequence.join('');\r\n  }\r\n  return result;\r\n};\r\n\r\nexport default {\r\n  get: get,\r\n};\r\n","import DiffContext from '../contexts/diff';\r\nimport PatchContext from '../contexts/patch';\r\nimport ReverseContext from '../contexts/reverse';\r\n\r\nimport lcs from './lcs';\r\n\r\nconst ARRAY_MOVE = 3;\r\n\r\nconst isArray =\r\n  typeof Array.isArray === 'function' ? Array.isArray : a => a instanceof Array;\r\n\r\nconst arrayIndexOf =\r\n  typeof Array.prototype.indexOf === 'function'\r\n    ? (array, item) => array.indexOf(item)\r\n    : (array, item) => {\r\n      let length = array.length;\r\n      for (let i = 0; i < length; i++) {\r\n        if (array[i] === item) {\r\n          return i;\r\n        }\r\n      }\r\n      return -1;\r\n    };\r\n\r\nfunction arraysHaveMatchByRef(array1, array2, len1, len2) {\r\n  for (let index1 = 0; index1 < len1; index1++) {\r\n    let val1 = array1[index1];\r\n    for (let index2 = 0; index2 < len2; index2++) {\r\n      let val2 = array2[index2];\r\n      if (index1 !== index2 && val1 === val2) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction matchItems(array1, array2, index1, index2, context) {\r\n  let value1 = array1[index1];\r\n  let value2 = array2[index2];\r\n  if (value1 === value2) {\r\n    return true;\r\n  }\r\n  if (typeof value1 !== 'object' || typeof value2 !== 'object') {\r\n    return false;\r\n  }\r\n  let objectHash = context.objectHash;\r\n  if (!objectHash) {\r\n    // no way to match objects was provided, try match by position\r\n    return context.matchByPosition && index1 === index2;\r\n  }\r\n  let hash1;\r\n  let hash2;\r\n  if (typeof index1 === 'number') {\r\n    context.hashCache1 = context.hashCache1 || [];\r\n    hash1 = context.hashCache1[index1];\r\n    if (typeof hash1 === 'undefined') {\r\n      context.hashCache1[index1] = hash1 = objectHash(value1, index1);\r\n    }\r\n  } else {\r\n    hash1 = objectHash(value1);\r\n  }\r\n  if (typeof hash1 === 'undefined') {\r\n    return false;\r\n  }\r\n  if (typeof index2 === 'number') {\r\n    context.hashCache2 = context.hashCache2 || [];\r\n    hash2 = context.hashCache2[index2];\r\n    if (typeof hash2 === 'undefined') {\r\n      context.hashCache2[index2] = hash2 = objectHash(value2, index2);\r\n    }\r\n  } else {\r\n    hash2 = objectHash(value2);\r\n  }\r\n  if (typeof hash2 === 'undefined') {\r\n    return false;\r\n  }\r\n  return hash1 === hash2;\r\n}\r\n\r\nexport const diffFilter = function arraysDiffFilter(context) {\r\n  if (!context.leftIsArray) {\r\n    return;\r\n  }\r\n\r\n  let matchContext = {\r\n    objectHash: context.options && context.options.objectHash,\r\n    matchByPosition: context.options && context.options.matchByPosition,\r\n  };\r\n  let commonHead = 0;\r\n  let commonTail = 0;\r\n  let index;\r\n  let index1;\r\n  let index2;\r\n  let array1 = context.left;\r\n  let array2 = context.right;\r\n  let len1 = array1.length;\r\n  let len2 = array2.length;\r\n\r\n  let child;\r\n\r\n  if (\r\n    len1 > 0 &&\r\n    len2 > 0 &&\r\n    !matchContext.objectHash &&\r\n    typeof matchContext.matchByPosition !== 'boolean'\r\n  ) {\r\n    matchContext.matchByPosition = !arraysHaveMatchByRef(\r\n      array1,\r\n      array2,\r\n      len1,\r\n      len2\r\n    );\r\n  }\r\n\r\n  // separate common head\r\n  while (\r\n    commonHead < len1 &&\r\n    commonHead < len2 &&\r\n    matchItems(array1, array2, commonHead, commonHead, matchContext)\r\n  ) {\r\n    index = commonHead;\r\n    child = new DiffContext(context.left[index], context.right[index]);\r\n    context.push(child, index);\r\n    commonHead++;\r\n  }\r\n  // separate common tail\r\n  while (\r\n    commonTail + commonHead < len1 &&\r\n    commonTail + commonHead < len2 &&\r\n    matchItems(\r\n      array1,\r\n      array2,\r\n      len1 - 1 - commonTail,\r\n      len2 - 1 - commonTail,\r\n      matchContext\r\n    )\r\n  ) {\r\n    index1 = len1 - 1 - commonTail;\r\n    index2 = len2 - 1 - commonTail;\r\n    child = new DiffContext(context.left[index1], context.right[index2]);\r\n    context.push(child, index2);\r\n    commonTail++;\r\n  }\r\n  let result;\r\n  if (commonHead + commonTail === len1) {\r\n    if (len1 === len2) {\r\n      // arrays are identical\r\n      context.setResult(undefined).exit();\r\n      return;\r\n    }\r\n    // trivial case, a block (1 or more consecutive items) was added\r\n    result = result || {\r\n      _t: 'a',\r\n    };\r\n    for (index = commonHead; index < len2 - commonTail; index++) {\r\n      result[index] = [array2[index]];\r\n    }\r\n    context.setResult(result).exit();\r\n    return;\r\n  }\r\n  if (commonHead + commonTail === len2) {\r\n    // trivial case, a block (1 or more consecutive items) was removed\r\n    result = result || {\r\n      _t: 'a',\r\n    };\r\n    for (index = commonHead; index < len1 - commonTail; index++) {\r\n      result[`_${index}`] = [array1[index], 0, 0];\r\n    }\r\n    context.setResult(result).exit();\r\n    return;\r\n  }\r\n  // reset hash cache\r\n  delete matchContext.hashCache1;\r\n  delete matchContext.hashCache2;\r\n\r\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\r\n  let trimmed1 = array1.slice(commonHead, len1 - commonTail);\r\n  let trimmed2 = array2.slice(commonHead, len2 - commonTail);\r\n  let seq = lcs.get(trimmed1, trimmed2, matchItems, matchContext);\r\n  let removedItems = [];\r\n  result = result || {\r\n    _t: 'a',\r\n  };\r\n  for (index = commonHead; index < len1 - commonTail; index++) {\r\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\r\n      // removed\r\n      result[`_${index}`] = [array1[index], 0, 0];\r\n      removedItems.push(index);\r\n    }\r\n  }\r\n\r\n  let detectMove = true;\r\n  if (\r\n    context.options &&\r\n    context.options.arrays &&\r\n    context.options.arrays.detectMove === false\r\n  ) {\r\n    detectMove = false;\r\n  }\r\n  let includeValueOnMove = false;\r\n  if (\r\n    context.options &&\r\n    context.options.arrays &&\r\n    context.options.arrays.includeValueOnMove\r\n  ) {\r\n    includeValueOnMove = true;\r\n  }\r\n\r\n  let removedItemsLength = removedItems.length;\r\n  for (index = commonHead; index < len2 - commonTail; index++) {\r\n    let indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\r\n    if (indexOnArray2 < 0) {\r\n      // added, try to match with a removed item and register as position move\r\n      let isMove = false;\r\n      if (detectMove && removedItemsLength > 0) {\r\n        for (\r\n          let removeItemIndex1 = 0;\r\n          removeItemIndex1 < removedItemsLength;\r\n          removeItemIndex1++\r\n        ) {\r\n          index1 = removedItems[removeItemIndex1];\r\n          if (\r\n            matchItems(\r\n              trimmed1,\r\n              trimmed2,\r\n              index1 - commonHead,\r\n              index - commonHead,\r\n              matchContext\r\n            )\r\n          ) {\r\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\r\n            result[`_${index1}`].splice(1, 2, index, ARRAY_MOVE);\r\n            if (!includeValueOnMove) {\r\n              // don't include moved value on diff, to save bytes\r\n              result[`_${index1}`][0] = '';\r\n            }\r\n\r\n            index2 = index;\r\n            child = new DiffContext(\r\n              context.left[index1],\r\n              context.right[index2]\r\n            );\r\n            context.push(child, index2);\r\n            removedItems.splice(removeItemIndex1, 1);\r\n            isMove = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (!isMove) {\r\n        // added\r\n        result[index] = [array2[index]];\r\n      }\r\n    } else {\r\n      // match, do inner diff\r\n      index1 = seq.indices1[indexOnArray2] + commonHead;\r\n      index2 = seq.indices2[indexOnArray2] + commonHead;\r\n      child = new DiffContext(context.left[index1], context.right[index2]);\r\n      context.push(child, index2);\r\n    }\r\n  }\r\n\r\n  context.setResult(result).exit();\r\n};\r\ndiffFilter.filterName = 'arrays';\r\n\r\nlet compare = {\r\n  numerically(a, b) {\r\n    return a - b;\r\n  },\r\n  numericallyBy(name) {\r\n    return (a, b) => a[name] - b[name];\r\n  },\r\n};\r\n\r\nexport const patchFilter = function nestedPatchFilter(context) {\r\n  if (!context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta._t !== 'a') {\r\n    return;\r\n  }\r\n  let index;\r\n  let index1;\r\n\r\n  let delta = context.delta;\r\n  let array = context.left;\r\n\r\n  // first, separate removals, insertions and modifications\r\n  let toRemove = [];\r\n  let toInsert = [];\r\n  let toModify = [];\r\n  for (index in delta) {\r\n    if (index !== '_t') {\r\n      if (index[0] === '_') {\r\n        // removed item from original array\r\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\r\n          toRemove.push(parseInt(index.slice(1), 10));\r\n        } else {\r\n          throw new Error(\r\n            `only removal or move can be applied at original array indices,` +\r\n              ` invalid diff type: ${delta[index][2]}`\r\n          );\r\n        }\r\n      } else {\r\n        if (delta[index].length === 1) {\r\n          // added item at new array\r\n          toInsert.push({\r\n            index: parseInt(index, 10),\r\n            value: delta[index][0],\r\n          });\r\n        } else {\r\n          // modified item at new array\r\n          toModify.push({\r\n            index: parseInt(index, 10),\r\n            delta: delta[index],\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // remove items, in reverse order to avoid sawing our own floor\r\n  toRemove = toRemove.sort(compare.numerically);\r\n  for (index = toRemove.length - 1; index >= 0; index--) {\r\n    index1 = toRemove[index];\r\n    let indexDiff = delta[`_${index1}`];\r\n    let removedValue = array.splice(index1, 1)[0];\r\n    if (indexDiff[2] === ARRAY_MOVE) {\r\n      // reinsert later\r\n      toInsert.push({\r\n        index: indexDiff[1],\r\n        value: removedValue,\r\n      });\r\n    }\r\n  }\r\n\r\n  // insert items, in reverse order to avoid moving our own floor\r\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\r\n  let toInsertLength = toInsert.length;\r\n  for (index = 0; index < toInsertLength; index++) {\r\n    let insertion = toInsert[index];\r\n    array.splice(insertion.index, 0, insertion.value);\r\n  }\r\n\r\n  // apply modifications\r\n  let toModifyLength = toModify.length;\r\n  let child;\r\n  if (toModifyLength > 0) {\r\n    for (index = 0; index < toModifyLength; index++) {\r\n      let modification = toModify[index];\r\n      child = new PatchContext(\r\n        context.left[modification.index],\r\n        modification.delta\r\n      );\r\n      context.push(child, modification.index);\r\n    }\r\n  }\r\n\r\n  if (!context.children) {\r\n    context.setResult(context.left).exit();\r\n    return;\r\n  }\r\n  context.exit();\r\n};\r\npatchFilter.filterName = 'arrays';\r\n\r\nexport const collectChildrenPatchFilter = function collectChildrenPatchFilter(\r\n  context\r\n) {\r\n  if (!context || !context.children) {\r\n    return;\r\n  }\r\n  if (context.delta._t !== 'a') {\r\n    return;\r\n  }\r\n  let length = context.children.length;\r\n  let child;\r\n  for (let index = 0; index < length; index++) {\r\n    child = context.children[index];\r\n    context.left[child.childName] = child.result;\r\n  }\r\n  context.setResult(context.left).exit();\r\n};\r\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\r\n\r\nexport const reverseFilter = function arraysReverseFilter(context) {\r\n  if (!context.nested) {\r\n    if (context.delta[2] === ARRAY_MOVE) {\r\n      context.newName = `_${context.delta[1]}`;\r\n      context\r\n        .setResult([\r\n          context.delta[0],\r\n          parseInt(context.childName.substr(1), 10),\r\n          ARRAY_MOVE,\r\n        ])\r\n        .exit();\r\n    }\r\n    return;\r\n  }\r\n  if (context.delta._t !== 'a') {\r\n    return;\r\n  }\r\n  let name;\r\n  let child;\r\n  for (name in context.delta) {\r\n    if (name === '_t') {\r\n      continue;\r\n    }\r\n    child = new ReverseContext(context.delta[name]);\r\n    context.push(child, name);\r\n  }\r\n  context.exit();\r\n};\r\nreverseFilter.filterName = 'arrays';\r\n\r\nlet reverseArrayDeltaIndex = (delta, index, itemDelta) => {\r\n  if (typeof index === 'string' && index[0] === '_') {\r\n    return parseInt(index.substr(1), 10);\r\n  } else if (isArray(itemDelta) && itemDelta[2] === 0) {\r\n    return `_${index}`;\r\n  }\r\n\r\n  let reverseIndex = +index;\r\n  for (let deltaIndex in delta) {\r\n    let deltaItem = delta[deltaIndex];\r\n    if (isArray(deltaItem)) {\r\n      if (deltaItem[2] === ARRAY_MOVE) {\r\n        let moveFromIndex = parseInt(deltaIndex.substr(1), 10);\r\n        let moveToIndex = deltaItem[1];\r\n        if (moveToIndex === +index) {\r\n          return moveFromIndex;\r\n        }\r\n        if (moveFromIndex <= reverseIndex && moveToIndex > reverseIndex) {\r\n          reverseIndex++;\r\n        } else if (\r\n          moveFromIndex >= reverseIndex &&\r\n          moveToIndex < reverseIndex\r\n        ) {\r\n          reverseIndex--;\r\n        }\r\n      } else if (deltaItem[2] === 0) {\r\n        let deleteIndex = parseInt(deltaIndex.substr(1), 10);\r\n        if (deleteIndex <= reverseIndex) {\r\n          reverseIndex++;\r\n        }\r\n      } else if (deltaItem.length === 1 && deltaIndex <= reverseIndex) {\r\n        reverseIndex--;\r\n      }\r\n    }\r\n  }\r\n\r\n  return reverseIndex;\r\n};\r\n\r\nexport function collectChildrenReverseFilter(context) {\r\n  if (!context || !context.children) {\r\n    return;\r\n  }\r\n  if (context.delta._t !== 'a') {\r\n    return;\r\n  }\r\n  let length = context.children.length;\r\n  let child;\r\n  let delta = {\r\n    _t: 'a',\r\n  };\r\n\r\n  for (let index = 0; index < length; index++) {\r\n    child = context.children[index];\r\n    let name = child.newName;\r\n    if (typeof name === 'undefined') {\r\n      name = reverseArrayDeltaIndex(\r\n        context.delta,\r\n        child.childName,\r\n        child.result\r\n      );\r\n    }\r\n    if (delta[name] !== child.result) {\r\n      delta[name] = child.result;\r\n    }\r\n  }\r\n  context.setResult(delta).exit();\r\n}\r\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\r\n","export const diffFilter = function datesDiffFilter(context) {\r\n  if (context.left instanceof Date) {\r\n    if (context.right instanceof Date) {\r\n      if (context.left.getTime() !== context.right.getTime()) {\r\n        context.setResult([context.left, context.right]);\r\n      } else {\r\n        context.setResult(undefined);\r\n      }\r\n    } else {\r\n      context.setResult([context.left, context.right]);\r\n    }\r\n    context.exit();\r\n  } else if (context.right instanceof Date) {\r\n    context.setResult([context.left, context.right]).exit();\r\n  }\r\n};\r\ndiffFilter.filterName = 'dates';\r\n","/* global diff_match_patch */\r\nimport dmp from 'diff-match-patch';\r\n\r\nlet TEXT_DIFF = 2;\r\nlet DEFAULT_MIN_LENGTH = 60;\r\nlet cachedDiffPatch = null;\r\n\r\nlet getDiffMatchPatch = function(required) {\r\n  /* jshint camelcase: false */\r\n\r\n  if (!cachedDiffPatch) {\r\n    let instance;\r\n    /* eslint-disable camelcase, new-cap */\r\n    if (typeof diff_match_patch !== 'undefined') {\r\n      // already loaded, probably a browser\r\n      instance =\r\n        typeof diff_match_patch === 'function'\r\n          ? new diff_match_patch()\r\n          : new diff_match_patch.diff_match_patch();\r\n    } else if (dmp) {\r\n      try {\r\n        instance = dmp && new dmp();\r\n      } catch (err) {\r\n        instance = null;\r\n      }\r\n    }\r\n    /* eslint-enable camelcase, new-cap */\r\n    if (!instance) {\r\n      if (!required) {\r\n        return null;\r\n      }\r\n      let error = new Error('text diff_match_patch library not found');\r\n      // eslint-disable-next-line camelcase\r\n      error.diff_match_patch_not_found = true;\r\n      throw error;\r\n    }\r\n    cachedDiffPatch = {\r\n      diff: function(txt1, txt2) {\r\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\r\n      },\r\n      patch: function(txt1, patch) {\r\n        let results = instance.patch_apply(\r\n          instance.patch_fromText(patch),\r\n          txt1\r\n        );\r\n        for (let i = 0; i < results[1].length; i++) {\r\n          if (!results[1][i]) {\r\n            let error = new Error('text patch failed');\r\n            error.textPatchFailed = true;\r\n          }\r\n        }\r\n        return results[0];\r\n      },\r\n    };\r\n  }\r\n  return cachedDiffPatch;\r\n};\r\n\r\nexport const diffFilter = function textsDiffFilter(context) {\r\n  if (context.leftType !== 'string') {\r\n    return;\r\n  }\r\n  let minLength =\r\n    (context.options &&\r\n      context.options.textDiff &&\r\n      context.options.textDiff.minLength) ||\r\n    DEFAULT_MIN_LENGTH;\r\n  if (context.left.length < minLength || context.right.length < minLength) {\r\n    context.setResult([context.left, context.right]).exit();\r\n    return;\r\n  }\r\n  // large text, try to use a text-diff algorithm\r\n  let diffMatchPatch = getDiffMatchPatch();\r\n  if (!diffMatchPatch) {\r\n    // diff-match-patch library not available,\r\n    // fallback to regular string replace\r\n    context.setResult([context.left, context.right]).exit();\r\n    return;\r\n  }\r\n  let diff = diffMatchPatch.diff;\r\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\r\n};\r\ndiffFilter.filterName = 'texts';\r\n\r\nexport const patchFilter = function textsPatchFilter(context) {\r\n  if (context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta[2] !== TEXT_DIFF) {\r\n    return;\r\n  }\r\n\r\n  // text-diff, use a text-patch algorithm\r\n  const patch = getDiffMatchPatch(true).patch;\r\n  context.setResult(patch(context.left, context.delta[0])).exit();\r\n};\r\npatchFilter.filterName = 'texts';\r\n\r\nconst textDeltaReverse = function(delta) {\r\n  let i;\r\n  let l;\r\n  let lines;\r\n  let line;\r\n  let lineTmp;\r\n  let header = null;\r\n  const headerRegex = /^@@ +-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/;\r\n  let lineHeader;\r\n  lines = delta.split('\\n');\r\n  for (i = 0, l = lines.length; i < l; i++) {\r\n    line = lines[i];\r\n    let lineStart = line.slice(0, 1);\r\n    if (lineStart === '@') {\r\n      header = headerRegex.exec(line);\r\n      lineHeader = i;\r\n\r\n      // fix header\r\n      lines[lineHeader] =\r\n        '@@ -' +\r\n        header[3] +\r\n        ',' +\r\n        header[4] +\r\n        ' +' +\r\n        header[1] +\r\n        ',' +\r\n        header[2] +\r\n        ' @@';\r\n    } else if (lineStart === '+') {\r\n      lines[i] = '-' + lines[i].slice(1);\r\n      if (lines[i - 1].slice(0, 1) === '+') {\r\n        // swap lines to keep default order (-+)\r\n        lineTmp = lines[i];\r\n        lines[i] = lines[i - 1];\r\n        lines[i - 1] = lineTmp;\r\n      }\r\n    } else if (lineStart === '-') {\r\n      lines[i] = '+' + lines[i].slice(1);\r\n    }\r\n  }\r\n  return lines.join('\\n');\r\n};\r\n\r\nexport const reverseFilter = function textsReverseFilter(context) {\r\n  if (context.nested) {\r\n    return;\r\n  }\r\n  if (context.delta[2] !== TEXT_DIFF) {\r\n    return;\r\n  }\r\n\r\n  // text-diff, use a text-diff algorithm\r\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\r\n};\r\nreverseFilter.filterName = 'texts';\r\n","import Processor from './processor';\r\nimport Pipe from './pipe';\r\nimport DiffContext from './contexts/diff';\r\nimport PatchContext from './contexts/patch';\r\nimport ReverseContext from './contexts/reverse';\r\nimport clone from './clone';\r\n\r\nimport * as trivial from './filters/trivial';\r\nimport * as nested from './filters/nested';\r\nimport * as arrays from './filters/arrays';\r\nimport * as dates from './filters/dates';\r\nimport * as texts from './filters/texts';\r\n\r\nclass DiffPatcher {\r\n  constructor(options) {\r\n    this.processor = new Processor(options);\r\n    this.processor.pipe(\r\n      new Pipe('diff')\r\n        .append(\r\n          nested.collectChildrenDiffFilter,\r\n          trivial.diffFilter,\r\n          dates.diffFilter,\r\n          texts.diffFilter,\r\n          nested.objectsDiffFilter,\r\n          arrays.diffFilter\r\n        )\r\n        .shouldHaveResult()\r\n    );\r\n    this.processor.pipe(\r\n      new Pipe('patch')\r\n        .append(\r\n          nested.collectChildrenPatchFilter,\r\n          arrays.collectChildrenPatchFilter,\r\n          trivial.patchFilter,\r\n          texts.patchFilter,\r\n          nested.patchFilter,\r\n          arrays.patchFilter\r\n        )\r\n        .shouldHaveResult()\r\n    );\r\n    this.processor.pipe(\r\n      new Pipe('reverse')\r\n        .append(\r\n          nested.collectChildrenReverseFilter,\r\n          arrays.collectChildrenReverseFilter,\r\n          trivial.reverseFilter,\r\n          texts.reverseFilter,\r\n          nested.reverseFilter,\r\n          arrays.reverseFilter\r\n        )\r\n        .shouldHaveResult()\r\n    );\r\n  }\r\n\r\n  options(...args) {\r\n    return this.processor.options(...args);\r\n  }\r\n\r\n  diff(left, right) {\r\n    return this.processor.process(new DiffContext(left, right));\r\n  }\r\n\r\n  patch(left, delta) {\r\n    return this.processor.process(new PatchContext(left, delta));\r\n  }\r\n\r\n  reverse(delta) {\r\n    return this.processor.process(new ReverseContext(delta));\r\n  }\r\n\r\n  unpatch(right, delta) {\r\n    return this.patch(right, this.reverse(delta));\r\n  }\r\n\r\n  clone(value) {\r\n    return clone(value);\r\n  }\r\n}\r\n\r\nexport default DiffPatcher;\r\n","const isArray =\r\n  typeof Array.isArray === 'function' ? Array.isArray : a => a instanceof Array;\r\n\r\nconst getObjectKeys =\r\n  typeof Object.keys === 'function'\r\n    ? obj => Object.keys(obj)\r\n    : obj => {\r\n      const names = [];\r\n      for (let property in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, property)) {\r\n          names.push(property);\r\n        }\r\n      }\r\n      return names;\r\n    };\r\n\r\nconst trimUnderscore = str => {\r\n  if (str.substr(0, 1) === '_') {\r\n    return str.slice(1);\r\n  }\r\n  return str;\r\n};\r\n\r\nconst arrayKeyToSortNumber = key => {\r\n  if (key === '_t') {\r\n    return -1;\r\n  } else {\r\n    if (key.substr(0, 1) === '_') {\r\n      return parseInt(key.slice(1), 10);\r\n    } else {\r\n      return parseInt(key, 10) + 0.1;\r\n    }\r\n  }\r\n};\r\n\r\nconst arrayKeyComparer = (key1, key2) =>\r\n  arrayKeyToSortNumber(key1) - arrayKeyToSortNumber(key2);\r\n\r\nclass BaseFormatter {\r\n  format(delta, left) {\r\n    const context = {};\r\n    this.prepareContext(context);\r\n    this.recurse(context, delta, left);\r\n    return this.finalize(context);\r\n  }\r\n\r\n  prepareContext(context) {\r\n    context.buffer = [];\r\n    context.out = function(...args) {\r\n      this.buffer.push(...args);\r\n    };\r\n  }\r\n\r\n  typeFormattterNotFound(context, deltaType) {\r\n    throw new Error(`cannot format delta type: ${deltaType}`);\r\n  }\r\n\r\n  typeFormattterErrorFormatter(context, err) {\r\n    return err.toString();\r\n  }\r\n\r\n  finalize({ buffer }) {\r\n    if (isArray(buffer)) {\r\n      return buffer.join('');\r\n    }\r\n  }\r\n\r\n  recurse(context, delta, left, key, leftKey, movedFrom, isLast) {\r\n    const useMoveOriginHere = delta && movedFrom;\r\n    const leftValue = useMoveOriginHere ? movedFrom.value : left;\r\n\r\n    if (typeof delta === 'undefined' && typeof key === 'undefined') {\r\n      return undefined;\r\n    }\r\n\r\n    const type = this.getDeltaType(delta, movedFrom);\r\n    const nodeType =\r\n      type === 'node' ? (delta._t === 'a' ? 'array' : 'object') : '';\r\n\r\n    if (typeof key !== 'undefined') {\r\n      this.nodeBegin(context, key, leftKey, type, nodeType, isLast);\r\n    } else {\r\n      this.rootBegin(context, type, nodeType);\r\n    }\r\n\r\n    let typeFormattter;\r\n    try {\r\n      typeFormattter =\r\n        this[`format_${type}`] || this.typeFormattterNotFound(context, type);\r\n      typeFormattter.call(\r\n        this,\r\n        context,\r\n        delta,\r\n        leftValue,\r\n        key,\r\n        leftKey,\r\n        movedFrom\r\n      );\r\n    } catch (err) {\r\n      this.typeFormattterErrorFormatter(\r\n        context,\r\n        err,\r\n        delta,\r\n        leftValue,\r\n        key,\r\n        leftKey,\r\n        movedFrom\r\n      );\r\n      if (typeof console !== 'undefined' && console.error) {\r\n        console.error(err.stack);\r\n      }\r\n    }\r\n\r\n    if (typeof key !== 'undefined') {\r\n      this.nodeEnd(context, key, leftKey, type, nodeType, isLast);\r\n    } else {\r\n      this.rootEnd(context, type, nodeType);\r\n    }\r\n  }\r\n\r\n  formatDeltaChildren(context, delta, left) {\r\n    const self = this;\r\n    this.forEachDeltaKey(delta, left, (key, leftKey, movedFrom, isLast) => {\r\n      self.recurse(\r\n        context,\r\n        delta[key],\r\n        left ? left[leftKey] : undefined,\r\n        key,\r\n        leftKey,\r\n        movedFrom,\r\n        isLast\r\n      );\r\n    });\r\n  }\r\n\r\n  forEachDeltaKey(delta, left, fn) {\r\n    const keys = getObjectKeys(delta);\r\n    const arrayKeys = delta._t === 'a';\r\n    const moveDestinations = {};\r\n    let name;\r\n    if (typeof left !== 'undefined') {\r\n      for (name in left) {\r\n        if (Object.prototype.hasOwnProperty.call(left, name)) {\r\n          if (\r\n            typeof delta[name] === 'undefined' &&\r\n            (!arrayKeys || typeof delta[`_${name}`] === 'undefined')\r\n          ) {\r\n            keys.push(name);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // look for move destinations\r\n    for (name in delta) {\r\n      if (Object.prototype.hasOwnProperty.call(delta, name)) {\r\n        const value = delta[name];\r\n        if (isArray(value) && value[2] === 3) {\r\n          moveDestinations[value[1].toString()] = {\r\n            key: name,\r\n            value: left && left[parseInt(name.substr(1))],\r\n          };\r\n          if (this.includeMoveDestinations !== false) {\r\n            if (\r\n              typeof left === 'undefined' &&\r\n              typeof delta[value[1]] === 'undefined'\r\n            ) {\r\n              keys.push(value[1].toString());\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (arrayKeys) {\r\n      keys.sort(arrayKeyComparer);\r\n    } else {\r\n      //keys.sort();\r\n    }\r\n    for (let index = 0, length = keys.length; index < length; index++) {\r\n      const key = keys[index];\r\n      if (arrayKeys && key === '_t') {\r\n        continue;\r\n      }\r\n      const leftKey = arrayKeys\r\n        ? typeof key === 'number' ? key : parseInt(trimUnderscore(key), 10)\r\n        : key;\r\n      const isLast = index === length - 1;\r\n      fn(key, leftKey, moveDestinations[leftKey], isLast);\r\n    }\r\n  }\r\n\r\n  getDeltaType(delta, movedFrom) {\r\n    if (typeof delta === 'undefined') {\r\n      if (typeof movedFrom !== 'undefined') {\r\n        return 'movedestination';\r\n      }\r\n      return 'unchanged';\r\n    }\r\n    if (isArray(delta)) {\r\n      if (delta.length === 1) {\r\n        return 'added';\r\n      }\r\n      if (delta.length === 2) {\r\n        return 'modified';\r\n      }\r\n      if (delta.length === 3 && delta[2] === 0) {\r\n        return 'deleted';\r\n      }\r\n      if (delta.length === 3 && delta[2] === 2) {\r\n        return 'textdiff';\r\n      }\r\n      if (delta.length === 3 && delta[2] === 3) {\r\n        return 'moved';\r\n      }\r\n    } else if (typeof delta === 'object') {\r\n      return 'node';\r\n    }\r\n    return 'unknown';\r\n  }\r\n\r\n  parseTextDiff(value) {\r\n    const output = [];\r\n    const lines = value.split('\\n@@ ');\r\n    for (let i = 0, l = lines.length; i < l; i++) {\r\n      const line = lines[i];\r\n      const lineOutput = {\r\n        pieces: [],\r\n      };\r\n      const location = /^(?:@@ )?[-+]?(\\d+),(\\d+)/.exec(line).slice(1);\r\n      lineOutput.location = {\r\n        line: location[0],\r\n        chr: location[1],\r\n      };\r\n      const pieces = line.split('\\n').slice(1);\r\n      for (\r\n        let pieceIndex = 0, piecesLength = pieces.length;\r\n        pieceIndex < piecesLength;\r\n        pieceIndex++\r\n      ) {\r\n        const piece = pieces[pieceIndex];\r\n        if (!piece.length) {\r\n          continue;\r\n        }\r\n        const pieceOutput = {\r\n          type: 'context',\r\n        };\r\n        if (piece.substr(0, 1) === '+') {\r\n          pieceOutput.type = 'added';\r\n        } else if (piece.substr(0, 1) === '-') {\r\n          pieceOutput.type = 'deleted';\r\n        }\r\n        pieceOutput.text = piece.slice(1);\r\n        lineOutput.pieces.push(pieceOutput);\r\n      }\r\n      output.push(lineOutput);\r\n    }\r\n    return output;\r\n  }\r\n}\r\n\r\nexport default BaseFormatter;\r\n","import BaseFormatter from './base';\r\n\r\nclass HtmlFormatter extends BaseFormatter {\r\n  typeFormattterErrorFormatter(context, err) {\r\n    context.out(`<pre class=\"jsondiffpatch-error\">${err}</pre>`);\r\n  }\r\n\r\n  formatValue(context, value) {\r\n    context.out(`<pre>${htmlEscape(JSON.stringify(value, null, 2))}</pre>`);\r\n  }\r\n\r\n  formatTextDiffString(context, value) {\r\n    let lines = this.parseTextDiff(value);\r\n    context.out('<ul class=\"jsondiffpatch-textdiff\">');\r\n    for (let i = 0, l = lines.length; i < l; i++) {\r\n      let line = lines[i];\r\n      context.out(\r\n        `<li><div class=\"jsondiffpatch-textdiff-location\">` +\r\n          `<span class=\"jsondiffpatch-textdiff-line-number\">${\r\n            line.location.line\r\n          }</span><span class=\"jsondiffpatch-textdiff-char\">${\r\n            line.location.chr\r\n          }</span></div><div class=\"jsondiffpatch-textdiff-line\">`\r\n      );\r\n      let pieces = line.pieces;\r\n      for (\r\n        let pieceIndex = 0, piecesLength = pieces.length;\r\n        pieceIndex < piecesLength;\r\n        pieceIndex++\r\n      ) {\r\n        /* global decodeURI */\r\n        let piece = pieces[pieceIndex];\r\n        context.out(\r\n          `<span class=\"jsondiffpatch-textdiff-${piece.type}\">${htmlEscape(\r\n            decodeURI(piece.text)\r\n          )}</span>`\r\n        );\r\n      }\r\n      context.out('</div></li>');\r\n    }\r\n    context.out('</ul>');\r\n  }\r\n\r\n  rootBegin(context, type, nodeType) {\r\n    let nodeClass = `jsondiffpatch-${type}${\r\n      nodeType ? ` jsondiffpatch-child-node-type-${nodeType}` : ''\r\n    }`;\r\n    context.out(`<div class=\"jsondiffpatch-delta ${nodeClass}\">`);\r\n  }\r\n\r\n  rootEnd(context) {\r\n    context.out(\r\n      `</div>${\r\n        context.hasArrows\r\n          ? `<script type=\"text/javascript\">setTimeout(` +\r\n            `${adjustArrows.toString()},10);</script>`\r\n          : ''\r\n      }`\r\n    );\r\n  }\r\n\r\n  nodeBegin(context, key, leftKey, type, nodeType) {\r\n    let nodeClass = `jsondiffpatch-${type}${\r\n      nodeType ? ` jsondiffpatch-child-node-type-${nodeType}` : ''\r\n    }`;\r\n    context.out(\r\n      `<li class=\"${nodeClass}\" data-key=\"${leftKey}\">` +\r\n        `<div class=\"jsondiffpatch-property-name\">${leftKey}</div>`\r\n    );\r\n  }\r\n\r\n  nodeEnd(context) {\r\n    context.out('</li>');\r\n  }\r\n\r\n  /* jshint camelcase: false */\r\n  /* eslint-disable camelcase */\r\n\r\n  format_unchanged(context, delta, left) {\r\n    if (typeof left === 'undefined') {\r\n      return;\r\n    }\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatValue(context, left);\r\n    context.out('</div>');\r\n  }\r\n\r\n  format_movedestination(context, delta, left) {\r\n    if (typeof left === 'undefined') {\r\n      return;\r\n    }\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatValue(context, left);\r\n    context.out('</div>');\r\n  }\r\n\r\n  format_node(context, delta, left) {\r\n    // recurse\r\n    let nodeType = delta._t === 'a' ? 'array' : 'object';\r\n    context.out(\r\n      `<ul class=\"jsondiffpatch-node jsondiffpatch-node-type-${nodeType}\">`\r\n    );\r\n    this.formatDeltaChildren(context, delta, left);\r\n    context.out('</ul>');\r\n  }\r\n\r\n  format_added(context, delta) {\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatValue(context, delta[0]);\r\n    context.out('</div>');\r\n  }\r\n\r\n  format_modified(context, delta) {\r\n    context.out('<div class=\"jsondiffpatch-value jsondiffpatch-left-value\">');\r\n    this.formatValue(context, delta[0]);\r\n    context.out(\r\n      '</div>' + '<div class=\"jsondiffpatch-value jsondiffpatch-right-value\">'\r\n    );\r\n    this.formatValue(context, delta[1]);\r\n    context.out('</div>');\r\n  }\r\n\r\n  format_deleted(context, delta) {\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatValue(context, delta[0]);\r\n    context.out('</div>');\r\n  }\r\n\r\n  format_moved(context, delta) {\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatValue(context, delta[0]);\r\n    context.out(\r\n      `</div><div class=\"jsondiffpatch-moved-destination\">${delta[1]}</div>`\r\n    );\r\n\r\n    // draw an SVG arrow from here to move destination\r\n    context.out(\r\n      /* jshint multistr: true */\r\n      `<div class=\"jsondiffpatch-arrow\" ` +\r\n        `style=\"position: relative; left: -34px;\">\r\n          <svg width=\"30\" height=\"60\" ` +\r\n        `style=\"position: absolute; display: none;\">\r\n          <defs>\r\n              <marker id=\"markerArrow\" markerWidth=\"8\" markerHeight=\"8\"\r\n                 refx=\"2\" refy=\"4\"\r\n                     orient=\"auto\" markerUnits=\"userSpaceOnUse\">\r\n                  <path d=\"M1,1 L1,7 L7,4 L1,1\" style=\"fill: #339;\" />\r\n              </marker>\r\n          </defs>\r\n          <path d=\"M30,0 Q-10,25 26,50\"\r\n            style=\"stroke: #88f; stroke-width: 2px; fill: none; ` +\r\n        `stroke-opacity: 0.5; marker-end: url(#markerArrow);\"\r\n          ></path>\r\n          </svg>\r\n      </div>`\r\n    );\r\n    context.hasArrows = true;\r\n  }\r\n\r\n  format_textdiff(context, delta) {\r\n    context.out('<div class=\"jsondiffpatch-value\">');\r\n    this.formatTextDiffString(context, delta[0]);\r\n    context.out('</div>');\r\n  }\r\n}\r\n\r\nfunction htmlEscape(text) {\r\n  let html = text;\r\n  let replacements = [\r\n    [/&/g, '&amp;'],\r\n    [/</g, '&lt;'],\r\n    [/>/g, '&gt;'],\r\n    [/'/g, '&apos;'],\r\n    [/\"/g, '&quot;'],\r\n  ];\r\n  for (let i = 0; i < replacements.length; i++) {\r\n    html = html.replace(replacements[i][0], replacements[i][1]);\r\n  }\r\n  return html;\r\n}\r\n\r\nlet adjustArrows = function jsondiffpatchHtmlFormatterAdjustArrows(nodeArg) {\r\n  const node = nodeArg || document;\r\n  let getElementText = ({ textContent, innerText }) => textContent || innerText;\r\n  let eachByQuery = (el, query, fn) => {\r\n    let elems = el.querySelectorAll(query);\r\n    for (let i = 0, l = elems.length; i < l; i++) {\r\n      fn(elems[i]);\r\n    }\r\n  };\r\n  let eachChildren = ({ children }, fn) => {\r\n    for (let i = 0, l = children.length; i < l; i++) {\r\n      fn(children[i], i);\r\n    }\r\n  };\r\n  eachByQuery(\r\n    node,\r\n    '.jsondiffpatch-arrow',\r\n    ({ parentNode, children, style }) => {\r\n      let arrowParent = parentNode;\r\n      let svg = children[0];\r\n      let path = svg.children[1];\r\n      svg.style.display = 'none';\r\n      let destination = getElementText(\r\n        arrowParent.querySelector('.jsondiffpatch-moved-destination')\r\n      );\r\n      let container = arrowParent.parentNode;\r\n      let destinationElem;\r\n      eachChildren(container, child => {\r\n        if (child.getAttribute('data-key') === destination) {\r\n          destinationElem = child;\r\n        }\r\n      });\r\n      if (!destinationElem) {\r\n        return;\r\n      }\r\n      try {\r\n        let distance = destinationElem.offsetTop - arrowParent.offsetTop;\r\n        svg.setAttribute('height', Math.abs(distance) + 6);\r\n        style.top = `${-8 + (distance > 0 ? 0 : distance)}px`;\r\n        let curve =\r\n          distance > 0\r\n            ? `M30,0 Q-10,${Math.round(distance / 2)} 26,${distance - 4}`\r\n            : `M30,${-distance} Q-10,${Math.round(-distance / 2)} 26,4`;\r\n        path.setAttribute('d', curve);\r\n        svg.style.display = '';\r\n      } catch (err) {}\r\n    }\r\n  );\r\n};\r\n\r\n/* jshint camelcase: true */\r\n/* eslint-enable camelcase */\r\n\r\nexport const showUnchanged = (show, node, delay) => {\r\n  let el = node || document.body;\r\n  let prefix = 'jsondiffpatch-unchanged-';\r\n  let classes = {\r\n    showing: `${prefix}showing`,\r\n    hiding: `${prefix}hiding`,\r\n    visible: `${prefix}visible`,\r\n    hidden: `${prefix}hidden`,\r\n  };\r\n  let list = el.classList;\r\n  if (!list) {\r\n    return;\r\n  }\r\n  if (!delay) {\r\n    list.remove(classes.showing);\r\n    list.remove(classes.hiding);\r\n    list.remove(classes.visible);\r\n    list.remove(classes.hidden);\r\n    if (show === false) {\r\n      list.add(classes.hidden);\r\n    }\r\n    return;\r\n  }\r\n  if (show === false) {\r\n    list.remove(classes.showing);\r\n    list.add(classes.visible);\r\n    setTimeout(() => {\r\n      list.add(classes.hiding);\r\n    }, 10);\r\n  } else {\r\n    list.remove(classes.hiding);\r\n    list.add(classes.showing);\r\n    list.remove(classes.hidden);\r\n  }\r\n  let intervalId = setInterval(() => {\r\n    adjustArrows(el);\r\n  }, 100);\r\n  setTimeout(() => {\r\n    list.remove(classes.showing);\r\n    list.remove(classes.hiding);\r\n    if (show === false) {\r\n      list.add(classes.hidden);\r\n      list.remove(classes.visible);\r\n    } else {\r\n      list.add(classes.visible);\r\n      list.remove(classes.hidden);\r\n    }\r\n    setTimeout(() => {\r\n      list.remove(classes.visible);\r\n      clearInterval(intervalId);\r\n    }, delay + 400);\r\n  }, delay);\r\n};\r\n\r\nexport const hideUnchanged = (node, delay) => showUnchanged(false, node, delay);\r\n\r\nexport default HtmlFormatter;\r\n\r\nlet defaultInstance;\r\n\r\nexport function format(delta, left) {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new HtmlFormatter();\r\n  }\r\n  return defaultInstance.format(delta, left);\r\n}\r\n","import BaseFormatter from './base';\r\n\r\nclass AnnotatedFormatter extends BaseFormatter {\r\n  constructor() {\r\n    super();\r\n    this.includeMoveDestinations = false;\r\n  }\r\n\r\n  prepareContext(context) {\r\n    super.prepareContext(context);\r\n    context.indent = function(levels) {\r\n      this.indentLevel =\r\n        (this.indentLevel || 0) + (typeof levels === 'undefined' ? 1 : levels);\r\n      this.indentPad = new Array(this.indentLevel + 1).join('&nbsp;&nbsp;');\r\n    };\r\n    context.row = (json, htmlNote) => {\r\n      context.out(\r\n        '<tr><td style=\"white-space: nowrap;\">' +\r\n          '<pre class=\"jsondiffpatch-annotated-indent\"' +\r\n          ' style=\"display: inline-block\">'\r\n      );\r\n      context.out(context.indentPad);\r\n      context.out('</pre><pre style=\"display: inline-block\">');\r\n      context.out(json);\r\n      context.out('</pre></td><td class=\"jsondiffpatch-delta-note\"><div>');\r\n      context.out(htmlNote);\r\n      context.out('</div></td></tr>');\r\n    };\r\n  }\r\n\r\n  typeFormattterErrorFormatter(context, err) {\r\n    context.row('', `<pre class=\"jsondiffpatch-error\">${err}</pre>`);\r\n  }\r\n\r\n  formatTextDiffString(context, value) {\r\n    const lines = this.parseTextDiff(value);\r\n    context.out('<ul class=\"jsondiffpatch-textdiff\">');\r\n    for (let i = 0, l = lines.length; i < l; i++) {\r\n      const line = lines[i];\r\n      context.out(\r\n        `<li><div class=\"jsondiffpatch-textdiff-location\">` +\r\n          `<span class=\"jsondiffpatch-textdiff-line-number\">${\r\n            line.location.line\r\n          }</span><span class=\"jsondiffpatch-textdiff-char\">${\r\n            line.location.chr\r\n          }</span></div><div class=\"jsondiffpatch-textdiff-line\">`\r\n      );\r\n      const pieces = line.pieces;\r\n      for (\r\n        let pieceIndex = 0, piecesLength = pieces.length;\r\n        pieceIndex < piecesLength;\r\n        pieceIndex++\r\n      ) {\r\n        const piece = pieces[pieceIndex];\r\n        context.out(\r\n          `<span class=\"jsondiffpatch-textdiff-${piece.type}\">${\r\n            piece.text\r\n          }</span>`\r\n        );\r\n      }\r\n      context.out('</div></li>');\r\n    }\r\n    context.out('</ul>');\r\n  }\r\n\r\n  rootBegin(context, type, nodeType) {\r\n    context.out('<table class=\"jsondiffpatch-annotated-delta\">');\r\n    if (type === 'node') {\r\n      context.row('{');\r\n      context.indent();\r\n    }\r\n    if (nodeType === 'array') {\r\n      context.row(\r\n        '\"_t\": \"a\",',\r\n        'Array delta (member names indicate array indices)'\r\n      );\r\n    }\r\n  }\r\n\r\n  rootEnd(context, type) {\r\n    if (type === 'node') {\r\n      context.indent(-1);\r\n      context.row('}');\r\n    }\r\n    context.out('</table>');\r\n  }\r\n\r\n  nodeBegin(context, key, leftKey, type, nodeType) {\r\n    context.row(`&quot;${key}&quot;: {`);\r\n    if (type === 'node') {\r\n      context.indent();\r\n    }\r\n    if (nodeType === 'array') {\r\n      context.row(\r\n        '\"_t\": \"a\",',\r\n        'Array delta (member names indicate array indices)'\r\n      );\r\n    }\r\n  }\r\n\r\n  nodeEnd(context, key, leftKey, type, nodeType, isLast) {\r\n    if (type === 'node') {\r\n      context.indent(-1);\r\n    }\r\n    context.row(`}${isLast ? '' : ','}`);\r\n  }\r\n\r\n  /* jshint camelcase: false */\r\n\r\n  /* eslint-disable camelcase */\r\n  format_unchanged() {}\r\n\r\n  format_movedestination() {}\r\n\r\n  format_node(context, delta, left) {\r\n    // recurse\r\n    this.formatDeltaChildren(context, delta, left);\r\n  }\r\n}\r\n\r\n/* eslint-enable camelcase */\r\n\r\nconst wrapPropertyName = name =>\r\n  `<pre style=\"display:inline-block\">&quot;${name}&quot;</pre>`;\r\n\r\nconst deltaAnnotations = {\r\n  added(delta, left, key, leftKey) {\r\n    const formatLegend = ' <pre>([newValue])</pre>';\r\n    if (typeof leftKey === 'undefined') {\r\n      return `new value${formatLegend}`;\r\n    }\r\n    if (typeof leftKey === 'number') {\r\n      return `insert at index ${leftKey}${formatLegend}`;\r\n    }\r\n    return `add property ${wrapPropertyName(leftKey)}${formatLegend}`;\r\n  },\r\n  modified(delta, left, key, leftKey) {\r\n    const formatLegend = ' <pre>([previousValue, newValue])</pre>';\r\n    if (typeof leftKey === 'undefined') {\r\n      return `modify value${formatLegend}`;\r\n    }\r\n    if (typeof leftKey === 'number') {\r\n      return `modify at index ${leftKey}${formatLegend}`;\r\n    }\r\n    return `modify property ${wrapPropertyName(leftKey)}${formatLegend}`;\r\n  },\r\n  deleted(delta, left, key, leftKey) {\r\n    const formatLegend = ' <pre>([previousValue, 0, 0])</pre>';\r\n    if (typeof leftKey === 'undefined') {\r\n      return `delete value${formatLegend}`;\r\n    }\r\n    if (typeof leftKey === 'number') {\r\n      return `remove index ${leftKey}${formatLegend}`;\r\n    }\r\n    return `delete property ${wrapPropertyName(leftKey)}${formatLegend}`;\r\n  },\r\n  moved(delta, left, key, leftKey) {\r\n    return (\r\n      `move from <span title=\"(position to remove at original state)\">` +\r\n      `index ${leftKey}</span> to <span title=\"(position to insert at final` +\r\n      ` state)\">index ${delta[1]}</span>`\r\n    );\r\n  },\r\n  textdiff(delta, left, key, leftKey) {\r\n    const location =\r\n      typeof leftKey === 'undefined'\r\n        ? ''\r\n        : typeof leftKey === 'number'\r\n          ? ` at index ${leftKey}`\r\n          : ` at property ${wrapPropertyName(leftKey)}`;\r\n    return (\r\n      `text diff${location}, format is <a href=\"https://code.google.com/` +\r\n      `p/google-diff-match-patch/wiki/Unidiff\">a variation of Unidiff</a>`\r\n    );\r\n  },\r\n};\r\n\r\nconst formatAnyChange = function(context, delta) {\r\n  const deltaType = this.getDeltaType(delta);\r\n  const annotator = deltaAnnotations[deltaType];\r\n  const htmlNote =\r\n    annotator &&\r\n    annotator.apply(annotator, Array.prototype.slice.call(arguments, 1));\r\n  let json = JSON.stringify(delta, null, 2);\r\n  if (deltaType === 'textdiff') {\r\n    // split text diffs lines\r\n    json = json.split('\\\\n').join('\\\\n\"+\\n   \"');\r\n  }\r\n  context.indent();\r\n  context.row(json, htmlNote);\r\n  context.indent(-1);\r\n};\r\n\r\n/* eslint-disable camelcase */\r\nAnnotatedFormatter.prototype.format_added = formatAnyChange;\r\nAnnotatedFormatter.prototype.format_modified = formatAnyChange;\r\nAnnotatedFormatter.prototype.format_deleted = formatAnyChange;\r\nAnnotatedFormatter.prototype.format_moved = formatAnyChange;\r\nAnnotatedFormatter.prototype.format_textdiff = formatAnyChange;\r\n/* eslint-enable camelcase */\r\n\r\n/* jshint camelcase: true */\r\n\r\nexport default AnnotatedFormatter;\r\n\r\nlet defaultInstance;\r\n\r\nexport function format(delta, left) {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new AnnotatedFormatter();\r\n  }\r\n  return defaultInstance.format(delta, left);\r\n}\r\n","import BaseFormatter from './base';\r\n\r\nconst OPERATIONS = {\r\n  add: 'add',\r\n  remove: 'remove',\r\n  replace: 'replace',\r\n  move: 'move',\r\n};\r\n\r\nclass JSONFormatter extends BaseFormatter {\r\n  constructor() {\r\n    super();\r\n    this.includeMoveDestinations = true;\r\n  }\r\n\r\n  prepareContext(context) {\r\n    super.prepareContext(context);\r\n    context.result = [];\r\n    context.path = [];\r\n    context.pushCurrentOp = function(obj) {\r\n      const {op, value} = obj;\r\n      const val = {\r\n        op,\r\n        path: this.currentPath(),\r\n      };\r\n      if (typeof value !== 'undefined') {\r\n        val.value = value;\r\n      }\r\n      this.result.push(val);\r\n    };\r\n\r\n    context.pushMoveOp = function(to) {\r\n      const from = this.currentPath();\r\n      this.result.push({\r\n        op: OPERATIONS.move,\r\n        from: from,\r\n        path: this.toPath(to),\r\n      });\r\n    };\r\n\r\n    context.currentPath = function() {\r\n      return `/${this.path.join('/')}`;\r\n    };\r\n\r\n    context.toPath = function(toPath) {\r\n      const to = this.path.slice();\r\n      to[to.length - 1] = toPath;\r\n      return `/${to.join('/')}`;\r\n    };\r\n  }\r\n\r\n  typeFormattterErrorFormatter(context, err) {\r\n    context.out(`[ERROR] ${err}`);\r\n  }\r\n\r\n  rootBegin() {}\r\n  rootEnd() {}\r\n\r\n  nodeBegin({ path }, key, leftKey) {\r\n    path.push(leftKey);\r\n  }\r\n\r\n  nodeEnd({ path }) {\r\n    path.pop();\r\n  }\r\n\r\n  /* jshint camelcase: false */\r\n  /* eslint-disable camelcase */\r\n\r\n  format_unchanged() {}\r\n\r\n  format_movedestination() {}\r\n\r\n  format_node(context, delta, left) {\r\n    this.formatDeltaChildren(context, delta, left);\r\n  }\r\n\r\n  format_added(context, delta) {\r\n    context.pushCurrentOp({op: OPERATIONS.add, value: delta[0]});\r\n  }\r\n\r\n  format_modified(context, delta) {\r\n    context.pushCurrentOp({op: OPERATIONS.replace, value: delta[1]});\r\n  }\r\n\r\n  format_deleted(context) {\r\n    context.pushCurrentOp({op: OPERATIONS.remove});\r\n  }\r\n\r\n  format_moved(context, delta) {\r\n    const to = delta[1];\r\n    context.pushMoveOp(to);\r\n  }\r\n\r\n  format_textdiff() {\r\n    throw new Error('Not implemented');\r\n  }\r\n\r\n  format(delta, left) {\r\n    let context = {};\r\n    this.prepareContext(context);\r\n    this.recurse(context, delta, left);\r\n    return context.result;\r\n  }\r\n}\r\n\r\n/* jshint camelcase: true */\r\n/* eslint-enable camelcase */\r\n\r\nexport default JSONFormatter;\r\n\r\nconst last = arr => arr[arr.length - 1];\r\n\r\nconst sortBy = (arr, pred) => {\r\n  arr.sort(pred);\r\n  return arr;\r\n};\r\n\r\nconst compareByIndexDesc = (indexA, indexB) => {\r\n  const lastA = parseInt(indexA, 10);\r\n  const lastB = parseInt(indexB, 10);\r\n  if (!(isNaN(lastA) || isNaN(lastB))) {\r\n    return lastB - lastA;\r\n  } else {\r\n    return 0;\r\n  }\r\n};\r\n\r\nconst opsByDescendingOrder = removeOps => sortBy(removeOps, (a, b) => {\r\n  const splitA = a.path.split('/');\r\n  const splitB = b.path.split('/');\r\n  if (splitA.length !== splitB.length) {\r\n    return splitA.length - splitB.length;\r\n  } else {\r\n    return compareByIndexDesc(last(splitA), last(splitB));\r\n  }\r\n});\r\n\r\nexport const partitionOps = (arr, fns) => {\r\n  const initArr = Array(fns.length + 1).fill().map(() => []);\r\n  return arr\r\n    .map(item => {\r\n      let position = fns.map(fn => fn(item)).indexOf(true);\r\n      if (position < 0) {\r\n        position = fns.length;\r\n      }\r\n      return { item, position };\r\n    })\r\n    .reduce((acc, item) => {\r\n      acc[ item.position ].push(item.item);\r\n      return acc;\r\n    }, initArr);\r\n};\r\nconst isMoveOp = ({op}) => op === 'move';\r\nconst isRemoveOp = ({op}) => op === 'remove';\r\n\r\nconst reorderOps = diff => {\r\n  const [ moveOps, removedOps, restOps ] =\r\n    partitionOps(diff, [ isMoveOp, isRemoveOp ]);\r\n  const removeOpsReverse = opsByDescendingOrder(removedOps);\r\n  return [ ...removeOpsReverse, ...moveOps, ...restOps ];\r\n};\r\n\r\nlet defaultInstance;\r\n\r\nexport const format = (delta, left) => {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new JSONFormatter();\r\n  }\r\n  return reorderOps(defaultInstance.format(delta, left));\r\n};\r\n\r\nexport const log = (delta, left) => {\r\n  console.log(format(delta, left));\r\n};\r\n","import chalk from 'chalk';\r\nimport BaseFormatter from './base';\r\n\r\nfunction chalkColor(name) {\r\n  return (\r\n    (chalk && chalk[name]) ||\r\n    function(...args) {\r\n      return args;\r\n    }\r\n  );\r\n}\r\n\r\nlet colors = {\r\n  added: chalkColor('green'),\r\n  deleted: chalkColor('red'),\r\n  movedestination: chalkColor('gray'),\r\n  moved: chalkColor('yellow'),\r\n  unchanged: chalkColor('gray'),\r\n  error: chalkColor('white.bgRed'),\r\n  textDiffLine: chalkColor('gray'),\r\n};\r\n\r\nclass ConsoleFormatter extends BaseFormatter {\r\n  constructor() {\r\n    super();\r\n    this.includeMoveDestinations = false;\r\n  }\r\n\r\n  prepareContext(context) {\r\n    super.prepareContext(context);\r\n    context.indent = function(levels) {\r\n      this.indentLevel =\r\n        (this.indentLevel || 0) + (typeof levels === 'undefined' ? 1 : levels);\r\n      this.indentPad = new Array(this.indentLevel + 1).join('  ');\r\n      this.outLine();\r\n    };\r\n    context.outLine = function() {\r\n      this.buffer.push(`\\n${this.indentPad || ''}`);\r\n    };\r\n    context.out = function(...args) {\r\n      for (let i = 0, l = args.length; i < l; i++) {\r\n        let lines = args[i].split('\\n');\r\n        let text = lines.join(`\\n${this.indentPad || ''}`);\r\n        if (this.color && this.color[0]) {\r\n          text = this.color[0](text);\r\n        }\r\n        this.buffer.push(text);\r\n      }\r\n    };\r\n    context.pushColor = function(color) {\r\n      this.color = this.color || [];\r\n      this.color.unshift(color);\r\n    };\r\n    context.popColor = function() {\r\n      this.color = this.color || [];\r\n      this.color.shift();\r\n    };\r\n  }\r\n\r\n  typeFormattterErrorFormatter(context, err) {\r\n    context.pushColor(colors.error);\r\n    context.out(`[ERROR]${err}`);\r\n    context.popColor();\r\n  }\r\n\r\n  formatValue(context, value) {\r\n    context.out(JSON.stringify(value, null, 2));\r\n  }\r\n\r\n  formatTextDiffString(context, value) {\r\n    let lines = this.parseTextDiff(value);\r\n    context.indent();\r\n    for (let i = 0, l = lines.length; i < l; i++) {\r\n      let line = lines[i];\r\n      context.pushColor(colors.textDiffLine);\r\n      context.out(`${line.location.line},${line.location.chr} `);\r\n      context.popColor();\r\n      let pieces = line.pieces;\r\n      for (\r\n        let pieceIndex = 0, piecesLength = pieces.length;\r\n        pieceIndex < piecesLength;\r\n        pieceIndex++\r\n      ) {\r\n        let piece = pieces[pieceIndex];\r\n        context.pushColor(colors[piece.type]);\r\n        context.out(piece.text);\r\n        context.popColor();\r\n      }\r\n      if (i < l - 1) {\r\n        context.outLine();\r\n      }\r\n    }\r\n    context.indent(-1);\r\n  }\r\n\r\n  rootBegin(context, type, nodeType) {\r\n    context.pushColor(colors[type]);\r\n    if (type === 'node') {\r\n      context.out(nodeType === 'array' ? '[' : '{');\r\n      context.indent();\r\n    }\r\n  }\r\n\r\n  rootEnd(context, type, nodeType) {\r\n    if (type === 'node') {\r\n      context.indent(-1);\r\n      context.out(nodeType === 'array' ? ']' : '}');\r\n    }\r\n    context.popColor();\r\n  }\r\n\r\n  nodeBegin(context, key, leftKey, type, nodeType) {\r\n    context.pushColor(colors[type]);\r\n    context.out(`${leftKey}: `);\r\n    if (type === 'node') {\r\n      context.out(nodeType === 'array' ? '[' : '{');\r\n      context.indent();\r\n    }\r\n  }\r\n\r\n  nodeEnd(context, key, leftKey, type, nodeType, isLast) {\r\n    if (type === 'node') {\r\n      context.indent(-1);\r\n      context.out(nodeType === 'array' ? ']' : `}${isLast ? '' : ','}`);\r\n    }\r\n    if (!isLast) {\r\n      context.outLine();\r\n    }\r\n    context.popColor();\r\n  }\r\n\r\n  /* jshint camelcase: false */\r\n  /* eslint-disable camelcase */\r\n\r\n  format_unchanged(context, delta, left) {\r\n    if (typeof left === 'undefined') {\r\n      return;\r\n    }\r\n    this.formatValue(context, left);\r\n  }\r\n\r\n  format_movedestination(context, delta, left) {\r\n    if (typeof left === 'undefined') {\r\n      return;\r\n    }\r\n    this.formatValue(context, left);\r\n  }\r\n\r\n  format_node(context, delta, left) {\r\n    // recurse\r\n    this.formatDeltaChildren(context, delta, left);\r\n  }\r\n\r\n  format_added(context, delta) {\r\n    this.formatValue(context, delta[0]);\r\n  }\r\n\r\n  format_modified(context, delta) {\r\n    context.pushColor(colors.deleted);\r\n    this.formatValue(context, delta[0]);\r\n    context.popColor();\r\n    context.out(' => ');\r\n    context.pushColor(colors.added);\r\n    this.formatValue(context, delta[1]);\r\n    context.popColor();\r\n  }\r\n\r\n  format_deleted(context, delta) {\r\n    this.formatValue(context, delta[0]);\r\n  }\r\n\r\n  format_moved(context, delta) {\r\n    context.out(`==> ${delta[1]}`);\r\n  }\r\n\r\n  format_textdiff(context, delta) {\r\n    this.formatTextDiffString(context, delta[0]);\r\n  }\r\n}\r\n\r\n/* eslint-enable camelcase */\r\n\r\n/* jshint camelcase: true */\r\n\r\nexport default ConsoleFormatter;\r\n\r\nlet defaultInstance;\r\n\r\nexport const format = (delta, left) => {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new ConsoleFormatter();\r\n  }\r\n  return defaultInstance.format(delta, left);\r\n};\r\n\r\nexport function log(delta, left) {\r\n  console.log(format(delta, left));\r\n}\r\n","// use as 2nd parameter for JSON.parse to revive Date instances\r\nexport default function dateReviver(key, value) {\r\n  let parts;\r\n  if (typeof value === 'string') {\r\n    // eslint-disable-next-line max-len\r\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+-])(\\d{2}):(\\d{2}))$/.exec(\r\n      value\r\n    );\r\n    if (parts) {\r\n      return new Date(\r\n        Date.UTC(\r\n          +parts[1],\r\n          +parts[2] - 1,\r\n          +parts[3],\r\n          +parts[4],\r\n          +parts[5],\r\n          +parts[6],\r\n          +(parts[7] || 0)\r\n        )\r\n      );\r\n    }\r\n  }\r\n  return value;\r\n}\r\n","import DiffPatcher from './diffpatcher';\r\nexport DiffPatcher from './diffpatcher';\r\n\r\nexport * as formatters from './formatters/index';\r\n\r\nexport * as console from './formatters/console';\r\n\r\nexport function create(options) {\r\n  return new DiffPatcher(options);\r\n}\r\n\r\nexport dateReviver from './date-reviver';\r\n\r\nlet defaultInstance;\r\n\r\nexport function diff() {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new DiffPatcher();\r\n  }\r\n  return defaultInstance.diff.apply(defaultInstance, arguments);\r\n}\r\n\r\nexport function patch() {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new DiffPatcher();\r\n  }\r\n  return defaultInstance.patch.apply(defaultInstance, arguments);\r\n}\r\n\r\nexport function unpatch() {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new DiffPatcher();\r\n  }\r\n  return defaultInstance.unpatch.apply(defaultInstance, arguments);\r\n}\r\n\r\nexport function reverse() {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new DiffPatcher();\r\n  }\r\n  return defaultInstance.reverse.apply(defaultInstance, arguments);\r\n}\r\n\r\nexport function clone() {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new DiffPatcher();\r\n  }\r\n  return defaultInstance.clone.apply(defaultInstance, arguments);\r\n}\r\n"],"names":["Processor","options","selfOptions","pipes","name","pipeArg","pipe","processor","input","context","nextPipe","lastPipe","lastContext","nextAfterChildren","next","process","hasResult","result","undefined","Pipe","filters","Error","debug","length","index","filter","log","filterName","exiting","resultCheck","msg","push","unshift","map","f","indexOf","params","Array","prototype","slice","call","arguments","splice","apply","should","error","noResult","Context","child","parent","childName","root","children","isArray","a","cloneRegExp","re","regexMatch","exec","toString","RegExp","clone","arg","Date","getTime","cloned","Object","hasOwnProperty","DiffContext","left","right","cloneDiffValues","defaultClone","babelHelpers.typeof","setResult","PatchContext","delta","ReverseContext","diffFilter","trivialMatchesDiffFilter","exit","leftType","rightType","leftIsArray","rightIsArray","patchFilter","trivialMatchesPatchFilter","nested","regexArgs","reverseFilter","trivialReferseFilter","collectChildrenDiffFilter","_t","objectsDiffFilter","propertyFilter","nestedPatchFilter","collectChildrenPatchFilter","nestedReverseFilter","collectChildrenReverseFilter","defaultMatch","array1","array2","index1","index2","lengthMatrix","match","len1","len2","x","y","matrix","Math","max","backtrack","subsequence","sameLetter","sequence","indices1","indices2","valueAtMatrixAbove","valueAtMatrixLeft","get","innerContext","join","ARRAY_MOVE","arrayIndexOf","array","item","i","arraysHaveMatchByRef","val1","val2","matchItems","value1","value2","objectHash","matchByPosition","hash1","hash2","hashCache1","hashCache2","arraysDiffFilter","matchContext","commonHead","commonTail","trimmed1","trimmed2","seq","lcs","removedItems","detectMove","arrays","includeValueOnMove","removedItemsLength","indexOnArray2","isMove","removeItemIndex1","compare","b","toRemove","toInsert","toModify","parseInt","sort","numerically","indexDiff","removedValue","numericallyBy","toInsertLength","insertion","value","toModifyLength","modification","arraysReverseFilter","newName","substr","reverseArrayDeltaIndex","itemDelta","reverseIndex","deltaIndex","deltaItem","moveFromIndex","moveToIndex","deleteIndex","datesDiffFilter","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","required","instance","diff_match_patch","dmp","err","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","patch","results","patch_apply","patch_fromText","textPatchFailed","textsDiffFilter","minLength","textDiff","diffMatchPatch","diff","textsPatchFilter","textDeltaReverse","l","lines","line","lineTmp","header","headerRegex","lineHeader","split","lineStart","textsReverseFilter","DiffPatcher","append","trivial","dates","texts","shouldHaveResult","reverse","getObjectKeys","keys","obj","names","property","trimUnderscore","str","arrayKeyToSortNumber","key","arrayKeyComparer","key1","key2","BaseFormatter","prepareContext","recurse","finalize","buffer","out","deltaType","leftKey","movedFrom","isLast","useMoveOriginHere","leftValue","type","getDeltaType","nodeType","nodeBegin","rootBegin","typeFormattter","typeFormattterNotFound","typeFormattterErrorFormatter","console","stack","nodeEnd","rootEnd","self","forEachDeltaKey","fn","arrayKeys","moveDestinations","includeMoveDestinations","output","lineOutput","location","pieces","pieceIndex","piecesLength","piece","pieceOutput","text","HtmlFormatter","htmlEscape","JSON","stringify","parseTextDiff","chr","decodeURI","nodeClass","hasArrows","adjustArrows","formatValue","formatDeltaChildren","formatTextDiffString","html","replacements","replace","jsondiffpatchHtmlFormatterAdjustArrows","nodeArg","node","document","getElementText","textContent","innerText","eachByQuery","el","query","elems","querySelectorAll","eachChildren","parentNode","style","arrowParent","svg","path","display","destination","querySelector","container","destinationElem","getAttribute","distance","offsetTop","setAttribute","abs","top","curve","round","showUnchanged","show","delay","body","prefix","classes","list","classList","remove","showing","hiding","visible","hidden","add","intervalId","setInterval","hideUnchanged","defaultInstance","format","AnnotatedFormatter","indent","levels","indentLevel","indentPad","row","json","htmlNote","wrapPropertyName","deltaAnnotations","formatLegend","formatAnyChange","annotator","format_added","format_modified","format_deleted","format_moved","format_textdiff","OPERATIONS","JSONFormatter","pushCurrentOp","op","val","currentPath","pushMoveOp","to","from","move","toPath","pop","last","arr","sortBy","pred","compareByIndexDesc","indexA","indexB","lastA","lastB","isNaN","opsByDescendingOrder","removeOps","splitA","splitB","partitionOps","fns","initArr","fill","position","reduce","acc","isMoveOp","isRemoveOp","reorderOps","moveOps","removedOps","restOps","removeOpsReverse","chalkColor","chalk","args","colors","ConsoleFormatter","outLine","color","pushColor","popColor","shift","textDiffLine","deleted","added","dateReviver","parts","UTC","create","unpatch"],"mappings":"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"}